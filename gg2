stages:
  - frontend
  - backend

variables:
  DJANGO_PORT: "8000"
  VUE_PORT: "9980"
  INTERNAL_IP: "localhost"  # Binding to localhost

# Frontend: Vue.js
frontend:
  stage: frontend
  tags:
    - shell
  script:
    - echo "Setting up Vue.js environment..."

    # Ensure npm dependencies are installed
    - echo "Installing frontend dependencies..."
    - npm install

    # Start Vue server
    - echo "Starting Vue server on $INTERNAL_IP:$VUE_PORT..."
    - screen -dmS vue bash -c "npm run dev -- --port $VUE_PORT --host $INTERNAL_IP"
    - echo "Vue server started on $INTERNAL_IP:$VUE_PORT"

# Backend: Django
backend:
  stage: backend
  tags:
    - shell
  script:
    - echo "Setting up Django environment..."

    # Install Python dependencies using Poetry
    - echo "Installing backend dependencies..."
    - poetry install

    # Ensure virtual environment is activated and start Django server
    - echo "Starting Django server on $INTERNAL_IP:$DJANGO_PORT..."
    - screen -dmS django bash -c "poetry shell && python manage.py runserver_plus $INTERNAL_IP:$DJANGO_PORT --cert-file devserver.crt --key-file devserver.key"
    - echo "Django server started on $INTERNAL_IP:$DJANGO_PORT"
