resource "null_resource" "web357_provision" {
  
  connection {
    type     = "ssh"
    user     = "ubuntu"
    password = "linux"  # Replace with actual password or key for SSH
    host     = cloudstack_instance.machine1.ip_address  # Reference the public IP of the instance
}
  provisioner "remote-exec" {
    
    inline = [
      "LGTM=0.0.0.0",
      "sudo sed -i 's/proxy_pass https:\\/\\/:3000;|proxy_pass https:\\/\\/${LGTM}:3000;/g' /etc/nginx/sites-available/default",
      "sudo apt update",
      "sudo apt install npm -y",
      "cd /home/ubuntu/omega-code/frontend && npm run build",
      "cd /home/ubuntu/omega-code/frontend && sudo cp -rf dist/*  /var/www/html/", 
      "cd /home/ubuntu/omega-code/frontend && sudo nginx -t", 
      "cd /home/ubuntu/omega-code/frontend && echo "linux" | sudo -S systemctl reload nginx",
      "cd /home/ubuntu/omega-code/frontend && sudo systemctl restart omega-backend.service"
 
       
    ]
 }
 
  depends_on = [
     cloudstack_instance.machine1,
     cloudstack_instance.machine2
    ]
}

